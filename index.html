<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>SaveMySpot ‚Äì Live Map</title>
  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9/dist/leaflet.css"/>
  <style>
    html,body{margin:0;padding:0;height:100%}
    #map{width:100%;height:100%}
    #locBtn{position:absolute;top:10px;left:10px;z-index:1000;background:#0088cc;color:white;border:none;padding:8px 12px;border-radius:6px;cursor:pointer}
  </style>
</head>
<body>
  <button id="locBtn">üìç Use my location</button>
  <div id="map"></div>

  <script src="https://unpkg.com/leaflet@1.9/dist/leaflet.js"></script>
  <script>
    /* 1. basic map */
    const map = L.map('map').setView([33.895, 35.511], 15);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '¬© OpenStreetMap'
    }).addTo(map);

    /* 2. load existing pins */
    fetch('pins.json').then(r => r.json()).then(arr =>
      arr.forEach(p => L.marker([p.lat, p.lng], {color: 'green'}).addTo(map)));

    /* 3. scout: long-press ‚Üí drop pin */
    map.on('contextmenu', e => {
      const lat = e.latlng.lat, lng = e.latlng.lng;
      L.marker([lat, lng], {color: 'green'}).addTo(map);
      window.open(`https://t.me/savemyspotmainbot?start=${lat},${lng}`, '_blank');
      alert('Pin dropped ‚Äì finish inside the bot chat!');
    });

    /* 4. general GPS unlock: button ‚Üí native prompt ‚Üí centre map */
    document.getElementById('locBtn').addEventListener('click', () => {
      navigator.geolocation.getCurrentPosition(
        pos => {
          const {latitude, longitude} = pos.coords;
          map.setView([latitude, longitude], 16);
          L.marker([latitude, longitude], {color: 'blue'}).addTo(map)
            .bindPopup('You are here').openPopup();
          document.getElementById('locBtn').style.display = 'none';
        },
        err => alert('Please allow location in your phone settings, then tap again.'),
        {enableHighAccuracy: true}
      );
    });
  </script>
</body>
</html>
