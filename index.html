<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>SaveMySpot – Google Map</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>html,body{margin:0;height:100%}#map{width:100%;height:100%}</style>
</head>
<body>
  <div id="map"></div>

  <!-- Google Maps JS (restricted to linkhamiltonsal-44.github.io) -->
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAic3NYemefMGfGJ2RN9zolcdmS30biM7o&libraries=marker"></script>
  <script>
    let map;

    /* each user gets his own fresh map */
    map = new google.maps.Map(document.getElementById('map'), {
      center: {lat: 33.895, lng: 35.511},
      zoom: 2,
      mapId: 'DEMO'
    });

    /* permission → street 19 (house level) */
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(
        pos => {
          const lat = pos.coords.latitude, lng = pos.coords.longitude;
          map.setCenter({lat, lng});
          map.setZoom(19);
          new google.maps.Marker({
            position: {lat, lng},
            map,
            title: 'You are here',
            icon: 'http://maps.google.com/mapfiles/ms/icons/blue-dot.png'
          });
        },
        () => console.log('GPS denied'),
        {enableHighAccuracy: true, timeout: 8000}
      );
    }

    /* scout: long-press → green pin */
    map.addListener('contextmenu', e => {
      const lat = e.latLng.lat(), lng = e.latLng.lng();
      new google.maps.Marker({
        position: {lat, lng},
        map,
        title: 'Available spot',
        icon: 'http://maps.google.com/mapfiles/ms/icons/green-dot.png'
      });
      window.open(`https://t.me/savemyspotmainbot?start=${lat},${lng}`, '_blank');
      alert('Pin dropped – finish inside the bot chat!');
    });

    /* driver: click green pin → pay 20 Stars */
    map.addListener('click', e => {
      if (e.domEvent.target.src && e.domEvent.target.src.includes('green-dot')) {
        new google.maps.InfoWindow({
          content: `<b>Spot ready</b><br>
                    <a href="https://t.me/\(BEEtUVjOKVH5BAAATCVL1nNAsX8" target="_blank">Rent 2 h – 20 ⭐</a>`
        }).open(map, e.placeId || e.latLng);
      }
    });
  </script>
</body>
</html>
